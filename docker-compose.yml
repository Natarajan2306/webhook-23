services:
  webhook:
    build: .
    ports:
      - "5001:5001"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - WEBHOOK_MODE=${WEBHOOK_MODE:-custom}
      - WOOCOMMERCE_WEBHOOK_SECRET=${WOOCOMMERCE_WEBHOOK_SECRET:-}
      - ALLOWED_IPS=${ALLOWED_IPS:-}
      - RATE_LIMIT=${RATE_LIMIT:-10}
      - MAX_PAYLOAD_SIZE=${MAX_PAYLOAD_SIZE:-1000000}
      - PORT=${PORT:-5001}
      - JENKINS_URL=${JENKINS_URL:-}
      - JENKINS_USER=${JENKINS_USER:-}
      - JENKINS_API_TOKEN=${JENKINS_API_TOKEN:-}
      - JENKINS_JOB_NAME=${JENKINS_JOB_NAME:-}
      - NGROK_URL=${NGROK_URL:-}  # Optional: Manually set ngrok URL
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Allows access to host machine from Docker
    restart: unless-stopped

  # Optional: ngrok for public URL (for testing)
  # Uncomment and configure if you need a public URL for WooCommerce webhooks
  # ngrok:
  #   image: ngrok/ngrok:latest
  #   command: http webhook:5001
  #   environment:
  #     - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN:-}
  #   ports:
  #     - "4040:4040"  # ngrok web interface
  #   depends_on:
  #     - webhook

