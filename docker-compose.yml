services:
  webhook:
    build: .
    expose:
      - "8080"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - WEBHOOK_MODE=${WEBHOOK_MODE:-custom}
      - WOOCOMMERCE_WEBHOOK_SECRET=${WOOCOMMERCE_WEBHOOK_SECRET:-}
      - ALLOWED_IPS=${ALLOWED_IPS:-}
      - RATE_LIMIT=${RATE_LIMIT:-10}
      - MAX_PAYLOAD_SIZE=${MAX_PAYLOAD_SIZE:-1000000}
      - PORT=${PORT:-8080}
      - JENKINS_URL=${JENKINS_URL:-}
      - JENKINS_USER=${JENKINS_USER:-}
      - JENKINS_API_TOKEN=${JENKINS_API_TOKEN:-}
      - JENKINS_JOB_NAME=${JENKINS_JOB_NAME:-}
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Allows access to host machine from Docker
    restart: unless-stopped
